@page "/Distributor/DistributorStocks"
@model Distributor_Web_App.Pages.Distributor.DistributorStocks.DistributorStocksModel
@{
    ViewData["Title"] = "Distributor Stock";
}

<h1>Current Distributor Stock</h1>

@if (!ModelState.IsValid)
{
    <div class="alert alert-danger" role="alert">
        @foreach (var modelState in ViewData.ModelState.Values)
        {
            foreach (var error in modelState.Errors)
            {
                <p>@error.ErrorMessage</p>
            }
        }
    </div>
}

<button type="button" class="btn btn-primary mb-3" data-bs-toggle="modal" data-bs-target="#addStockModal">
    Add New Stock
</button>

<table class="table">
    <thead>
        <tr>
            <th>Model ID</th>
            <th>Model Name</th>
            <th>Description</th>
            <th>Price</th>
            <th>Current Inventory</th>
            <th>Material Name</th>
            <th>Material Description</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var stockItem in Model.DistributorStocks)
        {
            <tr>
                <td>@stockItem.BlanketModel.ModelID</td>
                <td>@stockItem.BlanketModel.ModelName</td>
                <td>@stockItem.BlanketModel.Description</td>
                <td>LKR @stockItem.BlanketModel.Price</td>
                <td>@stockItem.Inventory</td>
                <td>@stockItem.BlanketModel.MaterialName</td>
                <td>@stockItem.BlanketModel.MaterialDescription</td>
                <td>
                    <button type="button" class="btn btn-sm btn-info" data-bs-toggle="modal" data-bs-target="#editStockModal"
                            data-id="@stockItem.DistributorStockID" data-inventory="@stockItem.Inventory">
                        Edit
                    </button>
                    <form method="post" asp-page-handler="Delete" style="display:inline;">
                        <input type="hidden" name="id" value="@stockItem.DistributorStockID" />
                        @Html.AntiForgeryToken()
                        <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm('Are you sure you want to delete this stock item?');">Delete</button>
                    </form>
                </td>
            </tr>
        }
    </tbody>
</table>

<!-- Add Stock Modal -->
<div class="modal fade" id="addStockModal" tabindex="-1" aria-labelledby="addStockModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-page-handler="Add">
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h5 class="modal-title" id="addStockModalLabel">Add New Stock</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <div class="form-group">
                        <label for="new-model-id">Blanket Model</label>
                        <select id="new-model-id" name="NewStock.ModelID" class="form-control" asp-items="@(new SelectList(Model.BlanketModels, "ModelID", "ModelName"))">
                            <option value="">-- Select a Model --</option>
                        </select>
                        <span asp-validation-for="NewStock.ModelID" class="text-danger"></span>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Add</button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Edit Stock Modal -->
<div class="modal fade" id="editStockModal" tabindex="-1" aria-labelledby="editStockModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <form method="post" asp-page-handler="Edit">
                @Html.AntiForgeryToken()
                <div class="modal-header">
                    <h5 class="modal-title" id="editStockModalLabel">Edit Stock</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="edit-id" name="id" />
                    <div class="form-group">
                        <label for="edit-inventory">Inventory</label>
                        <input type="number" id="edit-inventory" name="EditedStock.Inventory" class="form-control" />
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Changes</button>
                </div>
            </form>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        var editStockModal = document.getElementById('editStockModal');
        editStockModal.addEventListener('show.bs.modal', function (event) {
            var button = event.relatedTarget;
            var id = button.getAttribute('data-id');
            var inventory = button.getAttribute('data-inventory');

            var modalForm = editStockModal.querySelector('form');
            var modalInputId = modalForm.querySelector('#edit-id');
            var modalInputInventory = modalForm.querySelector('#edit-inventory');

            modalInputId.value = id;
            modalInputInventory.value = inventory;
        });
    </script>
}
